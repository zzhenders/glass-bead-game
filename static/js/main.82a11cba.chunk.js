(window["webpackJsonpgb-react"]=window["webpackJsonpgb-react"]||[]).push([[0],{17:function(e,t,n){e.exports=n(29)},22:function(e,t,n){},26:function(e,t,n){},29:function(e,t,n){"use strict";n.r(t);var a=n(0),s=n.n(a),o=n(15),r=n.n(o),i=(n(22),n(2)),c=n(3),l=n(6),u=n(4),p=n(1),h=n(5),d=n(12),m=n(9),f=n(16),b="";function k(e){var t="".concat(b).concat(e);return fetch(t,{}).then(function(e){return e.json()})}function g(e,t){var n="".concat(b,"/posts/bookmarked?postids=").concat(e.join("."),"&uid=").concat(t);return fetch(n).then(function(e){return e.json()})}function v(e){var t="".concat(b,"/users/").concat(e,"/following?mode=short");return fetch(t).then(function(e){return e.json()})}function O(e){var t="".concat(b,"/users/unames?userids=").concat(e.join("."));return fetch(t).then(function(e){return e.json()})}function w(e,t,n){var a="".concat(b,"/users/").concat(e,"/bookmarks/").concat(n);return fetch(a,{method:"POST",headers:{"Content-Type":"application/x-www-form-urlencoded"},body:"post_id=".concat(t)})}function j(e,t,n){var a="".concat(b,"/users/").concat(t,"/").concat(n);return fetch(a,{method:"POST",headers:{"Content-Type":"application/x-www-form-urlencoded"},body:"uid=".concat(e)})}b="";n(26);var E=n(7),y=function(e){function t(){return Object(i.a)(this,t),Object(l.a)(this,Object(u.a)(t).apply(this,arguments))}return Object(h.a)(t,e),Object(c.a)(t,[{key:"render",value:function(){return s.a.createElement("div",null,s.a.createElement(E.a,{id:this.props.id,icon:this.props.icon,alt:this.props.alt,size:"2x",onClick:this.props.onClick}))}}]),t}(s.a.Component),S=function(e){function t(e){var n;return Object(i.a)(this,t),(n=Object(l.a)(this,Object(u.a)(t).call(this,e))).state={terms:""},n.handleChange=n.handleChange.bind(Object(p.a)(n)),n.handleSubmit=n.handleSubmit.bind(Object(p.a)(n)),n}return Object(h.a)(t,e),Object(c.a)(t,[{key:"handleChange",value:function(e){this.setState({terms:e.target.value})}},{key:"handleSubmit",value:function(e){var t="/posts/search?terms=".concat(this.state.terms);this.props.setView("aggregate",t),this.props.toggleShowSearch(),e.preventDefault()}},{key:"render",value:function(){return s.a.createElement("form",{onSubmit:this.handleSubmit,id:"search-form",action:"#"},s.a.createElement("input",{id:"search-terms",type:"text",name:"terms",size:"10",onChange:this.handleChange}),s.a.createElement("label",null,"\xa0",s.a.createElement(E.a,{icon:"arrow-alt-circle-right",size:"lg"}),s.a.createElement("input",{type:"submit",value:"submit",hidden:!0})))}}]),t}(s.a.Component),C=function(e){function t(e){var n;return Object(i.a)(this,t),(n=Object(l.a)(this,Object(u.a)(t).call(this,e))).toggleShowSearch=function(){n.setState(function(e){return{isShowSearch:!e.isShowSearch}})},n.state={isShowSearch:!1},n}return Object(h.a)(t,e),Object(c.a)(t,[{key:"logout",value:function(e){!function(e){var t="".concat(b,"/users/logout");fetch(t,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify(e)})}({uid:e})}},{key:"render",value:function(){var e=this,t=this.props.uid;return s.a.createElement("nav",null,void 0!==t?s.a.createElement(s.a.Fragment,null,s.a.createElement(y,{id:"home-btn",alt:"Home",icon:"home",onClick:function(){e.props.setView("aggregate","/users/".concat(t,"/following/recent-posts"))}}),s.a.createElement(y,{id:"bookmarks-btn",alt:"Bookmarks",icon:["fas","bookmark"],onClick:function(){e.props.setView("aggregate","/users/".concat(t,"/bookmarks"))}}),s.a.createElement(y,{id:"userroot-btn",alt:"Root",icon:"leaf",onClick:function(){e.props.setView("aggregate","/users/".concat(t,"/posts/root"))}}),s.a.createElement(y,{id:"add-post-btn",alt:"Add",icon:"edit",onClick:function(){e.props.setView("write","")}}),s.a.createElement(y,{id:"search-btn",alt:"Search",icon:"search",onClick:this.toggleShowSearch}),this.state.isShowSearch?s.a.createElement(S,{toggleShowSearch:this.toggleShowSearch,setView:this.props.setView}):null,s.a.createElement(y,{id:"settings-btn",alt:"Settings",icon:"user-cog",onClick:function(){e.props.setView("settings","")}}),s.a.createElement(y,{id:"logout-btn",alt:"Logout",icon:"sign-out-alt",onClick:function(){e.logout(t),e.props.setUid(void 0),e.props.setView("login","")}})):s.a.createElement(s.a.Fragment,null,s.a.createElement(y,{id:"create-user-btn",alt:"Create Account",icon:"user-plus",onClick:function(){return e.props.setView("register","")}}),s.a.createElement(y,{id:"login-btn",alt:"Login",icon:"sign-in-alt",onClick:function(){return e.props.setView("login","")}})))}}]),t}(s.a.Component),P=n(11),_=n(10),V=function(e){function t(){return Object(i.a)(this,t),Object(l.a)(this,Object(u.a)(t).apply(this,arguments))}return Object(h.a)(t,e),Object(c.a)(t,[{key:"render",value:function(){var e=this,t=this.props.uid,n=this.props.post_id;return s.a.createElement("span",{className:"bookmarker",id:"pb{post_id}",onClick:function(){e.props.bookmarker(t,n)}},this.props.isBookmarked(n)?s.a.createElement(E.a,{icon:["fas","bookmark"]}):s.a.createElement(E.a,{icon:["far","bookmark"]}))}}]),t}(s.a.Component),U=function(e){function t(){return Object(i.a)(this,t),Object(l.a)(this,Object(u.a)(t).apply(this,arguments))}return Object(h.a)(t,e),Object(c.a)(t,[{key:"render",value:function(){var e=this;return s.a.createElement("i",{onClick:function(){e.props.setView("write","?".concat(e.props.post_id))}},s.a.createElement(E.a,{icon:"reply"}))}}]),t}(s.a.Component),B=function(e){function t(){return Object(i.a)(this,t),Object(l.a)(this,Object(u.a)(t).apply(this,arguments))}return Object(h.a)(t,e),Object(c.a)(t,[{key:"render",value:function(){var e=this,t=this.props.users[this.props.user_id],n=this.props.user_id;return s.a.createElement("span",{className:"user"},s.a.createElement("b",{className:"username"},"@",t),s.a.createElement("i",{onClick:function(t){t.stopPropagation(),e.props.setView("aggregate","/users/".concat(n,"/posts/root"))}},s.a.createElement(E.a,{icon:"leaf"})),s.a.createElement("i",{onClick:function(t){t.stopPropagation(),e.props.setView("aggregate","/users/".concat(n,"/posts?mode=full"))}},s.a.createElement(E.a,{icon:"tree"})),s.a.createElement("i",{onClick:function(a){a.stopPropagation(),e.props.setFollowing(e.props.uid,n,t)}},this.props.following.hasOwnProperty(n)?s.a.createElement(E.a,{icon:"minus-circle"}):s.a.createElement(E.a,{icon:"plus-circle"})))}}]),t}(s.a.Component),F=function(e){function t(){return Object(i.a)(this,t),Object(l.a)(this,Object(u.a)(t).apply(this,arguments))}return Object(h.a)(t,e),Object(c.a)(t,[{key:"render",value:function(){var e=this;return s.a.createElement("section",{className:"post"},s.a.createElement("h1",{className:"title",onClick:function(){return e.props.setView("bead",e.props.post_id)}},this.props.title),s.a.createElement("div",{className:"content"},this.props.content),s.a.createElement("div",{className:"options"},this.props.aggregateIsLoaded?s.a.createElement(s.a.Fragment,null,s.a.createElement(B,{uid:this.props.uid,user_id:this.props.user_id,users:this.props.users,setFollowing:this.props.setFollowing,following:this.props.following,setView:this.props.setView}),s.a.createElement(V,{uid:this.props.uid,post_id:this.props.post_id,bookmarker:this.props.bookmarker,isBookmarked:this.props.isBookmarked}),s.a.createElement(U,{setView:this.props.setView,post_id:this.props.post_id})):null,this.props.uid===this.props.user_id?s.a.createElement("span",{onClick:function(){e.props.setView("write",e.props.post_id)}},s.a.createElement(E.a,{className:"edit",icon:"edit"})):null))}}]),t}(s.a.Component);function N(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var a=Object.getOwnPropertySymbols(e);t&&(a=a.filter(function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable})),n.push.apply(n,a)}return n}function D(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?N(n,!0).forEach(function(t){Object(_.a)(e,t,n[t])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):N(n).forEach(function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))})}return e}var L=function(e){function t(e){var n;return Object(i.a)(this,t),(n=Object(l.a)(this,Object(u.a)(t).call(this,e))).setBookmarker=function(e,t){n.isBookmarked(t)?w(e,t,"delete").then(function(){return n.removeBookmark(t)}):w(e,t,"create").then(function(){return n.addBookmark(t)})},n.setFollowing=function(e,t,a){n.state.following.hasOwnProperty(t)?j(e,t,"unfollow").then(function(){return n.removeFollowing(t)}):j(e,t,"follow").then(function(){return n.addFollowing(t,a)})},n.state={bookmarks:{},posts:{},users:{},following:{},isLoaded:!1},n.lookupUsernames=n.lookupUsernames.bind(Object(p.a)(n)),n.lookupBookmarks=n.lookupBookmarks.bind(Object(p.a)(n)),n.lookupFollowing=n.lookupFollowing.bind(Object(p.a)(n)),n.setBookmarker=n.setBookmarker.bind(Object(p.a)(n)),n.setFollowing=n.setFollowing.bind(Object(p.a)(n)),n.addBookmark=n.addBookmark.bind(Object(p.a)(n)),n.removeBookmark=n.removeBookmark.bind(Object(p.a)(n)),n.isBookmarked=n.isBookmarked.bind(Object(p.a)(n)),n}return Object(h.a)(t,e),Object(c.a)(t,[{key:"addBookmark",value:function(e){var t=D({},this.state.bookmarks,Object(_.a)({},e,!0));this.setState({bookmarks:t})}},{key:"removeBookmark",value:function(e){var t=D({},this.state.bookmarks,Object(_.a)({},e,!1));this.setState({bookmarks:t})}},{key:"addFollowing",value:function(e,t){var n=D({},this.state.following,Object(_.a)({},e,t));this.setState({following:n})}},{key:"removeFollowing",value:function(e){var t=this.state.following;delete t[e],this.setState({following:t})}},{key:"isBookmarked",value:function(e){return this.state.bookmarks[e]}},{key:"lookupBookmarks",value:function(e,t){var n=this;g(e,t).then(function(e){n.setState({bookmarks:e})})}},{key:"lookupFollowing",value:function(e){var t=this;v(e).then(function(e){t.setState({following:e})})}},{key:"lookupUsernames",value:function(e){var t=this;O(e).then(function(e){t.setState({users:e})})}},{key:"loadAggregate",value:function(){var e=this;k(this.props.api).then(function(t){e.setState({posts:t})}).then(function(){var t=new Set,n=new Set;Object.entries(e.state.posts).forEach(function(e){var a=Object(P.a)(e,2),s=(a[0],a[1]);t.add(s.user_id),n.add(s.id)}),t=Array.from(t),n=Array.from(n),t.length>0&&n.length>0&&(e.lookupUsernames(t),e.lookupFollowing(e.props.uid),e.lookupBookmarks(n,e.props.uid)),e.setState({isLoaded:!0})})}},{key:"componentDidMount",value:function(){this.loadAggregate()}},{key:"componentDidUpdate",value:function(e){e.api!==this.props.api&&this.loadAggregate()}},{key:"render",value:function(){var e=this,t=[];return Object.entries(this.state.posts).forEach(function(n){var a=Object(P.a)(n,2),o=a[0],r=a[1];t.push(s.a.createElement(F,{uid:e.props.uid,key:o,post_id:r.id,title:r.title,content:r.content,user_id:r.user_id,users:e.state.users,following:e.state.following,setFollowing:e.setFollowing,bookmarker:e.setBookmarker,isBookmarked:e.isBookmarked,aggregateIsLoaded:e.state.isLoaded,setView:e.props.setView}))}),s.a.createElement("div",{className:"aggregate",id:"main"},s.a.createElement("div",{className:"view flex-flow-row-wrap"},t))}}]),t}(s.a.Component),R=function(e){function t(){return Object(i.a)(this,t),Object(l.a)(this,Object(u.a)(t).apply(this,arguments))}return Object(h.a)(t,e),Object(c.a)(t,[{key:"render",value:function(){var e=this,t=this.props.post_id;return s.a.createElement("section",{className:"post tile"},s.a.createElement("h1",{className:"title",onClick:function(){e.props.setView("bead",t)}},this.props.title),s.a.createElement("div",{className:"content"},this.props.content),s.a.createElement("div",{className:"options"},this.props.beadIsLoaded?s.a.createElement(B,{uid:this.props.uid,user_id:this.props.user_id,users:this.props.users,setFollowing:this.props.setFollowing,following:this.props.following,setView:this.props.setView}):null))}}]),t}(s.a.Component),T=function(e){function t(){return Object(i.a)(this,t),Object(l.a)(this,Object(u.a)(t).apply(this,arguments))}return Object(h.a)(t,e),Object(c.a)(t,[{key:"render",value:function(){var e=this,t=[],n="panel ".concat(this.props.type);return Object.entries(this.props.posts).forEach(function(n){var a=Object(P.a)(n,2),o=a[0],r=a[1];t.push(s.a.createElement(R,{key:o,uid:e.props.uid,post_id:r.id,title:r.title,content:r.content,user_id:r.user_id,users:e.props.users,beadIsLoaded:e.props.beadIsLoaded,setView:e.props.setView,setFollowing:e.props.setFollowing,following:e.props.following}))}),s.a.createElement("div",{className:n,id:"references"},t)}}]),t}(s.a.Component),x=function(e){function t(){return Object(i.a)(this,t),Object(l.a)(this,Object(u.a)(t).apply(this,arguments))}return Object(h.a)(t,e),Object(c.a)(t,[{key:"render",value:function(){var e=this;return s.a.createElement("article",{className:"post ext"},s.a.createElement("h1",{className:"title"},this.props.title),s.a.createElement("div",{className:"content"},this.props.content),s.a.createElement("div",{className:"options"},this.props.beadIsLoaded?s.a.createElement(s.a.Fragment,null,s.a.createElement(B,{uid:this.props.uid,user_id:this.props.user_id,users:this.props.users,setFollowing:this.props.setFollowing,following:this.props.following,setView:this.props.setView}),s.a.createElement(V,{uid:this.props.uid,post_id:this.props.post_id,bookmarker:this.props.bookmarker,isBookmarked:this.props.isBookmarked}),s.a.createElement(U,{setView:this.props.setView,post_id:this.props.post_id})):null,this.props.uid===this.props.user_id?s.a.createElement("i",{onClick:function(){e.props.setView("write",e.props.post_id)}},s.a.createElement(E.a,{icon:"edit"})):null))}}]),t}(s.a.Component);function A(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var a=Object.getOwnPropertySymbols(e);t&&(a=a.filter(function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable})),n.push.apply(n,a)}return n}function I(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?A(n,!0).forEach(function(t){Object(_.a)(e,t,n[t])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):A(n).forEach(function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))})}return e}var J=function(e){function t(e){var n;return Object(i.a)(this,t),(n=Object(l.a)(this,Object(u.a)(t).call(this,e))).setBookmarker=function(e,t){n.isBookmarked(t)?w(e,t,"delete").then(function(){return n.removeBookmark(t)}):w(e,t,"create").then(function(){return n.addBookmark(t)})},n.setFollowing=function(e,t,a){n.state.following.hasOwnProperty(t)?j(e,t,"unfollow").then(function(){return n.removeFollowing(t)}):j(e,t,"follow").then(function(){return n.addFollowing(t,a)})},n.state={bookmarks:{},following:{},users:{},references:{},responses:{},post:{},isLoaded:!1},n.lookupBookmarks=n.lookupBookmarks.bind(Object(p.a)(n)),n.lookupFollowing=n.lookupFollowing.bind(Object(p.a)(n)),n.lookupUsernames=n.lookupUsernames.bind(Object(p.a)(n)),n.setBookmarker=n.setBookmarker.bind(Object(p.a)(n)),n.setFollowing=n.setFollowing.bind(Object(p.a)(n)),n.addBookmark=n.addBookmark.bind(Object(p.a)(n)),n.removeBookmark=n.removeBookmark.bind(Object(p.a)(n)),n.isBookmarked=n.isBookmarked.bind(Object(p.a)(n)),n}return Object(h.a)(t,e),Object(c.a)(t,[{key:"addBookmark",value:function(e){var t=I({},this.state.bookmarks,Object(_.a)({},e,!0));this.setState({bookmarks:t})}},{key:"removeBookmark",value:function(e){var t=I({},this.state.bookmarks,Object(_.a)({},e,!1));this.setState({bookmarks:t})}},{key:"addFollowing",value:function(e,t){var n=I({},this.state.following,Object(_.a)({},e,t));this.setState({following:n})}},{key:"removeFollowing",value:function(e){var t=this.state.following;delete t[e],this.setState({following:t})}},{key:"isBookmarked",value:function(e){return this.state.bookmarks[e]}},{key:"lookupBookmarks",value:function(e,t){var n=this;g(e,t).then(function(e){n.setState({bookmarks:e})})}},{key:"lookupFollowing",value:function(e){var t=this;v(e).then(function(e){t.setState({following:e})})}},{key:"lookupUsernames",value:function(e){var t=this;O(e).then(function(e){t.setState({users:e})})}},{key:"loadBead",value:function(){var e=this,t=k("/posts/".concat(this.props.post_id,"/references")).then(function(t){e.setState({references:t})}),n=k("/posts/".concat(this.props.post_id)).then(function(t){e.setState({post:t})}),a=k("/posts/".concat(this.props.post_id,"/responses")).then(function(t){e.setState({responses:t})});Promise.all([t,n,a]).then(function(){var t=new Set,n=new Set;Object.entries(e.state.references).forEach(function(e){var a=Object(P.a)(e,2),s=(a[0],a[1]);t.add(s.user_id),n.add(s.id)}),Object.entries(e.state.responses).forEach(function(e){var a=Object(P.a)(e,2),s=(a[0],a[1]);t.add(s.user_id),n.add(s.id)}),t.add(e.state.post.user_id),n.add(e.state.post.id),e.lookupUsernames(Array.from(t)),e.lookupFollowing(e.props.uid),e.lookupBookmarks(Array.from(n),e.props.uid),e.setState({isLoaded:!0})})}},{key:"componentDidMount",value:function(){this.loadBead()}},{key:"componentDidUpdate",value:function(e){e.post_id!==this.props.post_id&&this.loadBead()}},{key:"render",value:function(){return s.a.createElement("div",{className:"bead",id:"main"},s.a.createElement(T,{type:"references",uid:this.props.uid,posts:this.state.references,users:this.state.users,beadIsLoaded:this.state.isLoaded,setView:this.props.setView,following:this.state.following,setFollowing:this.setFollowing}),s.a.createElement("div",{className:"view"},s.a.createElement(x,{uid:this.props.uid,post_id:this.state.post.id,title:this.state.post.title,content:this.state.post.content,user_id:this.state.post.user_id,users:this.state.users,following:this.state.following,setFollowing:this.setFollowing,bookmarker:this.setBookmarker,isBookmarked:this.isBookmarked,beadIsLoaded:this.state.isLoaded,setView:this.props.setView})),s.a.createElement(T,{type:"responses",uid:this.props.uid,posts:this.state.responses,users:this.state.users,beadIsLoaded:this.state.isLoaded,setView:this.props.setView,following:this.state.following,setFollowing:this.setFollowing}))}}]),t}(s.a.Component),M=function(e){function t(e){var n;return Object(i.a)(this,t),(n=Object(l.a)(this,Object(u.a)(t).call(this,e))).state={uname:"",pass:"",error:!1},n.handleUnameChange=n.handleUnameChange.bind(Object(p.a)(n)),n.handlePassChange=n.handlePassChange.bind(Object(p.a)(n)),n.handleSubmit=n.handleSubmit.bind(Object(p.a)(n)),n}return Object(h.a)(t,e),Object(c.a)(t,[{key:"handleUnameChange",value:function(e){this.setState({uname:e.target.value})}},{key:"handlePassChange",value:function(e){this.setState({pass:e.target.value})}},{key:"handleSubmit",value:function(e){var t=this;(e.preventDefault(),""!==this.state.uname&&""!==this.state.pass)&&function(e){var t="".concat(b,"/users/login");return fetch(t,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify(e)}).then(function(e){return e.json()})}({uname:this.state.uname,pass:this.state.pass}).then(function(e){t.props.setUid(e.uid),t.props.setView("aggregate","/users/".concat(e.uid,"/following/recent-posts"))}).catch(function(){t.setState({error:!0})})}},{key:"render",value:function(){return s.a.createElement("div",{className:"login view",id:"main"},s.a.createElement("div",{className:"login container"},s.a.createElement("form",{className:"login-form",onSubmit:this.handleSubmit},s.a.createElement("br",null),s.a.createElement("table",null,s.a.createElement("tbody",null,s.a.createElement("tr",null,s.a.createElement("td",null,s.a.createElement("label",{htmlFor:"uname"},"Username")),s.a.createElement("td",null,s.a.createElement("input",{type:"text",id:"uname",name:"uname",value:this.state.uname,onChange:this.handleUnameChange}))),s.a.createElement("tr",null,s.a.createElement("td",null,s.a.createElement("label",{htmlFor:"pass"},"Password")),s.a.createElement("td",null,s.a.createElement("input",{type:"password",id:"pass",name:"pass",value:this.state.pass,onChange:this.handlePassChange}))))),s.a.createElement("label",null,s.a.createElement("input",{type:"submit",value:"Login",hidden:!0}),s.a.createElement(E.a,{icon:"arrow-alt-circle-right",size:"lg"}),s.a.createElement("br",null)),this.state.error?s.a.createElement("b",{className:"error"},"username or password incorrect",s.a.createElement("br",null)):s.a.createElement("br",null),s.a.createElement("br",null))))}}]),t}(s.a.Component),z=function(e){function t(e){var n;return Object(i.a)(this,t),(n=Object(l.a)(this,Object(u.a)(t).call(this,e))).state={uname:"",editUnameError:!1,deleteUserError:!1,deleteConfirm:!1},n.handleUnameChange=n.handleUnameChange.bind(Object(p.a)(n)),n.handleEdit=n.handleEdit.bind(Object(p.a)(n)),n.handleDelete=n.handleDelete.bind(Object(p.a)(n)),n.handleDeleteConfirm=n.handleDeleteConfirm.bind(Object(p.a)(n)),n}return Object(h.a)(t,e),Object(c.a)(t,[{key:"handleUnameChange",value:function(e){this.setState({uname:e.target.value})}},{key:"handleEdit",value:function(e){var t=this;if(e.preventDefault(),""!==this.state.uname){var n={uname:this.state.uname};(function(e,t){var n="".concat(b,"/users/").concat(e,"/update");return fetch(n,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify(t)})})(this.props.uid,n).then(function(){t.props.setView("aggregate","/users/".concat(t.props.uid,"/following/recent-posts"))}).catch(function(){t.setState({editUnameError:!0})})}}},{key:"handleDelete",value:function(e){e.preventDefault(),this.setState({deleteConfirm:!0})}},{key:"handleDeleteConfirm",value:function(e){var t=this;e.preventDefault(),function(e){var t="".concat(b,"/users/").concat(e,"/delete");return fetch(t,{method:"POST"})}(this.props.uid).then(function(){t.props.setUid(void 0),t.props.setView("login","")})}},{key:"render",value:function(){return s.a.createElement("div",{className:"settings view",id:"main"},s.a.createElement("div",{className:"container"},s.a.createElement("form",{className:"user-settings",id:"change-uname",onSubmit:this.handleEdit},s.a.createElement("label",{htmlFor:"uname"},"Change Username:"),s.a.createElement("br",null),s.a.createElement("input",{type:"text",id:"uname",name:"uname",value:this.state.uname,onChange:this.handleUnameChange}),s.a.createElement("br",null),s.a.createElement("div",{className:"settings-options"},s.a.createElement("span",{id:"change-name"},s.a.createElement("input",{type:"submit",value:"Change Username",hidden:!0}),s.a.createElement(E.a,{icon:"user-check"})),this.state.deleteConfirm?s.a.createElement(s.a.Fragment,null,s.a.createElement("span",{id:"delete-user",className:"warning",onClick:this.handleDeleteConfirm},s.a.createElement(E.a,{icon:"user-minus"})),s.a.createElement("br",null),s.a.createElement("p",{className:"warning"},"Are you sure you want to delete your account?")):s.a.createElement("span",{id:"delete-user",onClick:this.handleDelete},s.a.createElement(E.a,{icon:"user-minus"})))),this.state.editUnameError?s.a.createElement("b",null,"That Username is Taken!"):null))}}]),t}(s.a.Component),W=function(e){function t(e){var n;return Object(i.a)(this,t),(n=Object(l.a)(this,Object(u.a)(t).call(this,e))).state={uname:"",pass:"",confirmPass:"",unameError:!1,passError:!1},n.handleUnameChange=n.handleUnameChange.bind(Object(p.a)(n)),n.handlePassChange=n.handlePassChange.bind(Object(p.a)(n)),n.handleConfirmPassChange=n.handleConfirmPassChange.bind(Object(p.a)(n)),n.validatePass=n.validatePass.bind(Object(p.a)(n)),n.handleSubmit=n.handleSubmit.bind(Object(p.a)(n)),n}return Object(h.a)(t,e),Object(c.a)(t,[{key:"handleUnameChange",value:function(e){this.setState({uname:e.target.value})}},{key:"handlePassChange",value:function(e){this.setState({pass:e.target.value})}},{key:"handleConfirmPassChange",value:function(e){this.setState({confirmPass:e.target.value})}},{key:"validatePass",value:function(){var e=new Set(["password","PASSWORD",this.state.uname,"".concat(this.state.uname,"1"),"".concat(this.state.uname,"!")]);return!(this.state.pass.length<8||this.state.pass.length>128)&&!e.has(this.state.pass)}},{key:"handleSubmit",value:function(e){var t=this;(e.preventDefault(),""!==this.state.uname&&""!==this.state.pass&&this.state.pass===this.state.confirmPass)&&(!0===this.validatePass()?function(e){var t="".concat(b,"/users/create");return fetch(t,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify(e)}).then(function(e){return e.json()})}({uname:this.state.uname,pass:this.state.pass}).then(function(e){t.props.setUid(e.uid),t.props.setView("aggregate","/users/".concat(e.uid,"/following/recent-posts"))}).catch(function(){t.setState({unameError:!0})}):this.setState({passError:!0}))}},{key:"render",value:function(){return s.a.createElement("div",{className:"register view",id:"main"},s.a.createElement("div",{className:"register container"},s.a.createElement("form",{className:"signup",onSubmit:this.handleSubmit},s.a.createElement("br",null),s.a.createElement("table",null,s.a.createElement("tbody",null,s.a.createElement("tr",null,s.a.createElement("td",null,s.a.createElement("label",{htmlFor:"uname"},"Username")),s.a.createElement("td",null,s.a.createElement("input",{type:"text",id:"uname",name:"uname",value:this.state.uname,onChange:this.handleUnameChange}))),s.a.createElement("tr",null,s.a.createElement("td",null,s.a.createElement("label",{htmlFor:"pass"},"Password")),s.a.createElement("td",null,s.a.createElement("input",{type:"password",id:"pass",name:"pass",value:this.state.pass,onChange:this.handlePassChange}))),s.a.createElement("tr",null,s.a.createElement("td",null,s.a.createElement("label",{htmlFor:"confirm-password"},"Confirm")),s.a.createElement("td",null,s.a.createElement("input",{type:"password",id:"confirm-password",name:"confirm-password",value:this.state.confirmPass,onChange:this.handleConfirmPassChange}))))),s.a.createElement("label",null,s.a.createElement("input",{type:"submit",value:"Register User",hidden:!0}),s.a.createElement(E.a,{icon:"user-plus"}),s.a.createElement("br",null)),this.state.unameError?s.a.createElement("b",{className:"error"},"Username already registered!",s.a.createElement("br",null)):s.a.createElement("br",null),this.state.passError?s.a.createElement("b",{className:"error"},"Password too short or simple!",s.a.createElement("br",null)):s.a.createElement("br",null))))}}]),t}(s.a.Component);function q(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var a=Object.getOwnPropertySymbols(e);t&&(a=a.filter(function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable})),n.push.apply(n,a)}return n}function H(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?q(n,!0).forEach(function(t){Object(_.a)(e,t,n[t])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):q(n).forEach(function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))})}return e}var $=function(e){function t(e){var n;return Object(i.a)(this,t),(n=Object(l.a)(this,Object(u.a)(t).call(this,e))).state={numReferences:Object.keys(n.props.references).length,showSelector:!1,selectionOptions:{},selection:void 0},n.toggleShowSelector=n.toggleShowSelector.bind(Object(p.a)(n)),n.handleChange=n.handleChange.bind(Object(p.a)(n)),n.doReference=n.doReference.bind(Object(p.a)(n)),n}return Object(h.a)(t,e),Object(c.a)(t,[{key:"toggleShowSelector",value:function(){this.setState({showSelector:!this.state.showSelector})}},{key:"handleChange",value:function(e){this.setState({selection:e.target.value})}},{key:"doReference",value:function(e){e.preventDefault(),void 0!==this.state.selection&&Object.keys(this.state.selectionOptions).length>0&&(this.props.addReference(this.state.selection,this.state.selectionOptions[this.state.selection]),this.setState({selection:void 0}),this.toggleShowSelector())}},{key:"componentDidMount",value:function(){var e=H({},this.props.user_posts,{},this.props.bookmarks);Object.entries(this.props.references).forEach(function(t){delete e[t[0]]}),Object.keys(e).length>0&&this.setState({selectionOptions:e,selection:Object.keys(e)[0]})}},{key:"componentDidUpdate",value:function(e){if(e.references!==this.props.references){var t=H({},this.props.user_posts,{},this.props.bookmarks);Object.entries(this.props.references).forEach(function(e){delete t[e[0]]}),Object.keys(t).length>0&&this.setState({selectionOptions:t,selection:Object.keys(t)[0],numReferences:Object.keys(this.props.references).length})}}},{key:"render",value:function(){var e=this,t=[];Object.entries(this.state.selectionOptions).forEach(function(e){var n=Object(P.a)(e,2),a=n[0],o=n[1];t.push(s.a.createElement("option",{key:a,value:a},o))});var n=[];return Object.entries(this.props.references).forEach(function(t){var a=Object(P.a)(t,2),o=a[0],r=a[1];n.push(s.a.createElement("span",{className:"ref",key:o},r,s.a.createElement("span",{className:"ref-minus",onClick:function(){e.props.removeReference(o)}},s.a.createElement(E.a,{icon:"minus"}))))}),s.a.createElement("div",{className:"citations"},n,s.a.createElement("br",null),!this.state.showSelector&&this.state.numReferences<4&&t.length>0?s.a.createElement("span",{className:"ref-plus",onClick:this.toggleShowSelector},s.a.createElement(E.a,{icon:"plus"})):null,this.state.showSelector&&this.state.numReferences<4&&t.length>0?s.a.createElement("form",{onSubmit:this.doReference},s.a.createElement("select",{value:this.state.selection,name:"h",onChange:this.handleChange},t),s.a.createElement("label",null,s.a.createElement("input",{type:"submit",value:"Add",hidden:!0}),s.a.createElement(E.a,{icon:"plus"}))):null)}}]),t}(s.a.Component);function G(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var a=Object.getOwnPropertySymbols(e);t&&(a=a.filter(function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable})),n.push.apply(n,a)}return n}function K(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?G(n,!0).forEach(function(t){Object(_.a)(e,t,n[t])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):G(n).forEach(function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))})}return e}var Q=function(e){function t(e){var n;return Object(i.a)(this,t),(n=Object(l.a)(this,Object(u.a)(t).call(this,e))).state={user_id:"",references:{},bookmarks:{},user_posts:{},content:"",title:"",isLoaded:!1},n.addReference=n.addReference.bind(Object(p.a)(n)),n.removeReference=n.removeReference.bind(Object(p.a)(n)),n.handleTitleChange=n.handleTitleChange.bind(Object(p.a)(n)),n.handleContentChange=n.handleContentChange.bind(Object(p.a)(n)),n.handleSubmit=n.handleSubmit.bind(Object(p.a)(n)),n}return Object(h.a)(t,e),Object(c.a)(t,[{key:"handleTitleChange",value:function(e){this.setState({title:e.target.value})}},{key:"handleContentChange",value:function(e){this.setState({content:e.target.value})}},{key:"addReference",value:function(e,t){var n=K({},this.state.references,Object(_.a)({},e,t));this.setState({references:n})}},{key:"removeReference",value:function(e){var t=K({},this.state.references);delete t[e],this.setState({references:t})}},{key:"handleSubmit",value:function(e){var t=this;e.preventDefault(),function(e,t){var n="".concat(b).concat(e);return fetch(n,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify(t)})}(""===this.props.post_id||"?"===this.props.post_id[0]?"/posts/create":"/posts/".concat(this.props.post_id,"/edit"),{references:Object.keys(this.state.references),title:this.state.title,content:this.state.content,user_id:this.state.user_id,uid:this.props.uid}).then(function(){t.props.setView("aggregate","/users/".concat(t.props.uid,"/following/recent-posts"))})}},{key:"loadCreate",value:function(){var e=this;this.setState({user_id:this.props.uid});var t=k("/users/".concat(this.props.uid,"/posts?mode=short")).then(function(t){e.setState({user_posts:t})}),n=k("/users/".concat(this.props.uid,"/bookmarks?mode=short")).then(function(t){e.setState({bookmarks:t})});if("?"===this.props.post_id[0]){var a=k("/posts/".concat(this.props.post_id.slice(1),"?mode=short")).then(function(t){e.setState({references:t})});Promise.all([t,n,a]).then(function(){return e.setState({isLoaded:!0})})}else Promise.all([t,n]).then(function(){return e.setState({isLoaded:!0})})}},{key:"loadEdit",value:function(){var e=this,t=k("/posts/".concat(this.props.post_id)).then(function(t){e.setState({content:t.content,title:t.title,user_id:t.user_id})}),n=k("/posts/".concat(this.props.post_id,"/references?mode=short")).then(function(t){e.setState({references:t})}),a=k("/users/".concat(this.props.uid,"/posts?mode=short")).then(function(t){e.setState({user_posts:t})}),s=k("/users/".concat(this.props.uid,"/bookmarks?mode=short")).then(function(t){e.setState({bookmarks:t})});Promise.all([t,n,a,s]).then(function(){e.setState({isLoaded:!0})})}},{key:"componentDidMount",value:function(){""===this.props.post_id||"?"===this.props.post_id[0]?this.loadCreate():this.loadEdit()}},{key:"render",value:function(){return s.a.createElement("div",{className:"edit view",id:"main"},s.a.createElement("div",{className:"write container"},this.state.isLoaded?s.a.createElement($,{references:this.state.references,bookmarks:this.state.bookmarks,user_posts:this.state.user_posts,addReference:this.addReference,removeReference:this.removeReference}):null,s.a.createElement("form",{onSubmit:this.handleSubmit,className:"editor",method:"post"},"title:",s.a.createElement("br",null),s.a.createElement("input",{type:"text",name:"title",value:this.state.title,onChange:this.handleTitleChange}),s.a.createElement("br",null),"content:",s.a.createElement("br",null),s.a.createElement("textarea",{type:"text",name:"content",onChange:this.handleContentChange,value:this.state.content}),s.a.createElement("br",null),s.a.createElement("label",{className:"woptions"},s.a.createElement("input",{type:"submit",value:"submit",hidden:!0}),s.a.createElement(E.a,{icon:"check"})))))}}]),t}(s.a.Component),X=function(e){function t(){return Object(i.a)(this,t),Object(l.a)(this,Object(u.a)(t).apply(this,arguments))}return Object(h.a)(t,e),Object(c.a)(t,[{key:"render",value:function(){switch(this.props.page){case"aggregate":return s.a.createElement(L,{uid:this.props.uid,api:this.props.data,setView:this.props.setView});case"bead":return s.a.createElement(J,{uid:this.props.uid,post_id:this.props.data,setView:this.props.setView});case"write":return s.a.createElement(Q,{uid:this.props.uid,post_id:this.props.data,setView:this.props.setView,setUid:this.props.setUid});case"register":return s.a.createElement(W,{setView:this.props.setView,setUid:this.props.setUid});case"login":return s.a.createElement(M,{setView:this.props.setView,setUid:this.props.setUid});case"settings":return s.a.createElement(z,{uid:this.props.uid,setView:this.props.setView,setUid:this.props.setUid});default:return s.a.createElement(M,{setView:this.props.setView,setUid:this.props.setUid})}}}]),t}(s.a.Component);d.b.add(m.m,m.t,m.e,m.b,f.a,m.d,m.l,m.r,m.n,m.a,m.c,m.j,m.h,m.k,m.f,m.p,m.o,m.i,m.g,m.q,m.s);var Y=function(e){function t(e){var n;return Object(i.a)(this,t),(n=Object(l.a)(this,Object(u.a)(t).call(this,e))).state={data:"",page:"",uid:void 0,checkedSession:!1},n.setView=n.setView.bind(Object(p.a)(n)),n.setUid=n.setUid.bind(Object(p.a)(n)),n}return Object(h.a)(t,e),Object(c.a)(t,[{key:"setView",value:function(e,t){this.setState(function(n){return{page:e,data:t}})}},{key:"setUid",value:function(e){this.setState({uid:e})}},{key:"loadSession",value:function(){var e=this;return function(){var e="".concat(b,"/users/auth");return fetch(e).then(function(e){return e.json()})}().then(function(t){null===t.uid?(e.setView("",""),e.setUid(void 0)):(e.setView("aggregate","/users/".concat(t.uid,"/following/recent-posts")),e.setUid(t.uid))})}},{key:"componentDidMount",value:function(){var e=this;this.loadSession().then(function(){return e.setState({checkedSession:!0})})}},{key:"render",value:function(){return s.a.createElement("div",{id:"app"},this.state.checkedSession?s.a.createElement(s.a.Fragment,null,s.a.createElement(C,{setView:this.setView,setUid:this.setUid,uid:this.state.uid}),s.a.createElement(X,{setView:this.setView,setUid:this.setUid,page:this.state.page,data:this.state.data,uid:this.state.uid})):s.a.createElement(s.a.Fragment,null,s.a.createElement("nav",null),s.a.createElement("div",{id:"main"})))}}]),t}(s.a.Component);Boolean("localhost"===window.location.hostname||"[::1]"===window.location.hostname||window.location.hostname.match(/^127(?:\.(?:25[0-5]|2[0-4][0-9]|[01]?[0-9][0-9]?)){3}$/));r.a.render(s.a.createElement(Y,null),document.getElementById("root")),"serviceWorker"in navigator&&navigator.serviceWorker.ready.then(function(e){e.unregister()})}},[[17,1,2]]]);
//# sourceMappingURL=main.82a11cba.chunk.js.map